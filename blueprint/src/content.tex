% Turán project — blueprint content
% This file is included by both web.tex and print.tex. Do NOT add a \begin{document} here.

% Turán project — blueprint content
% This file is included by both web.tex and print.tex. Do NOT add a \begin{document} here.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Preliminaries
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Section 1 — Concentrating support on a clique
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Concentrating support on a clique - Improve Operartion}

\begin{definition}[A better distribution]
    \label{def:Better}
    \lean{Better}
Given a weight function $W$, a choice of a weight function $\texttt{Better}\;W$ with $\mathrm{supp}(\texttt{Better}\;W)\subseteq\mathrm{supp}(W)$ and $W.\mathrm{fw}\le (\texttt{Better}\;W).\mathrm{fw}$.
\end{definition}

\begin{definition}[Single transfer]
    \label{def:Improve}
    \lean{Improve}
Given distinct vertices $\texttt{loose}\ne\texttt{gain}$, the weight function $\texttt{Improve}\;W\;\texttt{loose}\;\texttt{gain}$ moves a small amount from $\texttt{loose}$ to $\texttt{gain}$.
\end{definition}

\begin{lemma}[Sum splitting along the partition]
    \label{lem:Improve_partition_sum_split}
    \lean{Improve_partition_sum_split}
    \uses{lem:Improve_edgeFinset_partition}
Summing \(\texttt{vp}\) over \(E\) splits as the sum over the gain-incidence, plus the loose-incidence, plus the complement.
\end{lemma}

\begin{lemma}[Gain-incidence increases]
    \label{lem:Improve_gain_contribution_increase}
    \lean{Improve_gain_contribution_increase}
    The sum on the gain-incidence increases by \(W.w\;\texttt{loose}\) times the sum of the other-endpoint weights incident to `gain`.
\end{lemma}

\begin{lemma}[Loose-incidence becomes zero]
    \label{lem:Improve_loose_contribution_zero}
    \lean{Improve_loose_contribution_zero}
    The sum on the loose-incidence is zero after \texttt{Improve}.
\end{lemma}

\begin{lemma}[Unchanged complement]
    \label{lem:Improve_unchanged_edge_sum}
    \lean{Improve_unchanged_edge_sum}
    Edges outside the union of gain/loose incidences keep the same value under \texttt{Improve}.
\end{lemma}

\begin{lemma}[Transfer does not decrease $\mathrm{fw}$]
    \label{lem:Improve_total_weight_nondec}
    \lean{Improve_total_weight_nondec}
    \uses{lem:Improve_partition_sum_split, lem:Improve_unchanged_edge_sum, lem:Improve_gain_contribution_increase, lem:Improve_loose_contribution_zero}
Under the neighbourhood condition used in the code, $W.\mathrm{fw}\le (\texttt{Improve}\;W\;\texttt{loose}\;\texttt{gain}).\mathrm{fw}$.
\end{lemma}

\begin{lemma}[Improve strictly reduces support]
    \label{lem:Improve_support_strictly_reduced}
    \lean{Improve_support_strictly_reduced}
    \uses{def:Improve, lem:Improve_loose_weight_zero}
If the neighbourhood condition fails, the transfer strictly reduces the support of $W$.
\end{lemma}

\begin{theorem}[Support of \texttt{Better} is a clique]
    \label{thm:Better_forms_clique}
    \lean{Better_forms_clique}
    \uses{def:Improve, lem:Improve_total_weight_nondec, lem:Improve_support_strictly_reduced}
The support of $(\texttt{Better}\,W)$ forms a clique: every two distinct vertices of positive weight are adjacent in $G$.
\end{theorem}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Section 2 — Two–vertex enhance step
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The Enhance Operation}

\begin{definition}[Enhance]
  \label{def:Enhance}
  \lean{Enhance}
  \leanok
  Defines the operation of transferring weight from one vertex to another,
  provided the two vertices are non-adjacent. This operation is central to the
  second phase of the proof, where we later reduce the support size while ensuring
  the edge weight does not decrease.
\end{definition}

\begin{lemma}[Sum over support]
  \label{lem:sum_over_support}
  \lean{sum_over_support}
  \leanok
  Expresses the total vertex weight as the sum of weights over the support.
\end{lemma}

\begin{lemma}[Supported edge partition]
  \label{lem:supported_edge_partition}
  \lean{supported_edge_partition}
  \leanok
  Splits the edge set into edges incident to the chosen vertices (“gain” and “loose”)
  and the remaining edges.
\end{lemma}

\begin{lemma}[Enhance gain sum]
  \label{lem:Enhance_gain_sum}
  \lean{Enhance_gain_sum}
  \leanok
  Shows that under \ref{def:Enhance}, the contribution of the gain vertex’s edges
  increases by exactly the transferred weight multiplied by the sum of its neighbor weights.
\end{lemma}

\begin{lemma}[Enhance loose sum]
  \label{lem:Enhance_loose_sum}
  \lean{Enhance_loose_sum}
  \leanok
  Shows that under \ref{def:Enhance}, the contribution of the loose vertex’s edges
  becomes zero.
\end{lemma}

\begin{definition}[Bijection inside the clique]
    \label{def:the_bij}
    \lean{the_bij}
    \leanok
    Provides a bijection between the supported incidence edges at `loose` (without s(loose, gain)) and the supported incidence edges at `gain` (without s(loose, gain))
\end{definition}

\begin{lemma}[Bijection preserves]
  \label{lem:the_bij_same}
  \lean{the_bij_same}
  \leanok
   Shows that the bijection preserves the "other" weight: for any edge from the supported incidence set of loose, the weigh at the "other" vertex equals that in its image uneder the bijection
\end{lemma}

\begin{lemma}[Loose/gain equality]
  \label{lem:Enhance_sum_loose_gain_equal}
  \lean{Enhance_sum_loose_gain_equal}
  \leanok
  Shows that the total weight moved from the loose vertex to the gain vertex
  balances correctly in the edge contributions.
  \uses{def:the_bij, lem:the_bij_same}
\end{lemma}

\begin{lemma}[Complement unchanged]
  \label{lem:Enhance_sum_complement_unchanged}
  \lean{Enhance_sum_complement_unchanged}
  \leanok
  Shows that edges not incident to gain or loose are unaffected by \ref{def:Enhance}.
\end{lemma}

\begin{lemma}[Edge contribution increase]
  \label{lem:Enhance_edge_gainloose_increase}
  \lean{Enhance_edge_gainloose_increase}
  \leanok
  Proves that the net contribution from gain and loose together does not decrease.
\end{lemma}

\begin{lemma}[Support edges unchanged]
  \label{lem:Enhance_support_edges_same}
  \lean{Enhance_support_edges_same}
  \leanok
  Shows that for vertices outside of gain and loose, the contributions remain identical
  before and after applying \ref{def:Enhance}.
\end{lemma}

\begin{theorem}[Enhance increases edge weight]
  \label{thm:Enhance_total_weight_stricinc}
  \lean{Enhance_total_weight_stricinc}
  \leanok
  \uses{lem:supported_edge_partition,
        lem:Enhance_gain_sum,
        lem:Enhance_loose_sum,
        lem:Enhance_sum_loose_gain_equal,
        lem:Enhance_sum_complement_unchanged,
        lem:Enhance_edge_gainloose_increase,
        lem:Enhance_support_edges_same}
  Establishes that applying \ref{def:Enhance} strictly increases the total
  edge weight
\end{theorem}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Section 3 — Equalising weights on the clique
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Equalizing the weights on the clique - EnhanceD}

\begin{definition}[Carefully chosen $\varepsilon$]
  \label{def:the_e}
  \lean{the_e}
  \leanok
  Define $\displaystyle \mathsf{the\_\varepsilon} := \max - \frac{1}{|\mathrm{supp}|}$.
\end{definition}

\begin{definition}[Maximising the number of uniform vertices]
  \label{def:max_uniform_support}
  \lean{max_uniform_support}
  \leanok
  Define the maximal $m$ achievable by any distribution with support contained in that of $W$
  and with at least as much edge weight.
\end{definition}

\begin{lemma}[Best uniform distribution exists]
  \label{lem:exists_best_uniform}
  \lean{exists_best_uniform}
  \uses{def:max_uniform_support}
  \leanok
  There exists a distribution realising this maximum with edge weight $\ge W.\mathrm{fw}$.
\end{lemma}

\begin{definition}[UniformBetter]
  \label{def:UniformBetter}
  \lean{UniformBetter}
  \uses{lem:exists_best_uniform}
  \leanok
  A choice of a maximiser from \autoref{lem:exists_best_uniform}.
\end{definition}

\begin{definition}[Enhanced]
  \label{def:Enhanced}
  \lean{Enhanced}
  \uses{def:Enhance, def:the_e}
  \leanok
  Defines `Enhanced` weight function : transfering weight from the argmax vertex `loose` to the argmin vertex `gain`, using the previous in Section 2 defined function `Enhance` by the amount defined `the_\varepsilon`
\end{definition}

\begin{lemma}
    \label{lem:Enhanced_unaffected}
    \lean{Enhanced_unaffected}
    \uses{def:Enhance, def:Enhanced}
    Shows that under `Enhanced` every vertex that originally had weight 1/|support|, remains with the same weight
\end{lemma}

\begin{lemma}
    \label{lem:Enhanced_effect_argmax}
    \lean{Enhanced_effect_argmax}
    \uses{def:Enhance, def:Enhanced}
    Shows that the weight at the argmax vertex becomes the target uniform weight after Enhanced.
\end{lemma}

\begin{lemma}
    \label{lem:Enhanced_inc_uniform_count}
    \lean{Enhanced_inc_uniform_count}
    \uses{def:Enhanced, lem:Enhanced_effect_argmax, lem:Enhanced_unaffected}
    Shows that the number of uniform weight vertices increases after Enhanced.
\end{lemma}

\begin{lemma}
    \label{lem:UniformBetter_support_equiv}
    \use{def:UniformBetter}
    \leanok
    The support of $W$ forms a clique if and only if the support at UniformBetter also forms a clique.
\end{lemma}

\begin{lemma}[Uniform weights on the support]
  \label{lem:UniformBetter_constant_support}
  \lean{UniformBetter_constant_support}
  \uses{def:UniformBetter, def:Enhanced, lem:UniformBetter_support_equiv, lem:Enhanced_inc_uniform_count, thm:Enhance_total_weight_stricinc}
  \leanok
  Every support vertex of $\texttt{UniformBetter}\,W$ has weight $1/|\mathrm{supp}|$.
\end{lemma}

\begin{lemma}[Edge values under UniformBetter]
  \label{lem:UniformBetter_edges_value}
  \lean{UniformBetter_edges_value}
  \uses{lem:UniformBetter_constant_support}
  \leanok
  Every supported edge has value $(1/|\mathrm{supp}|)^2$.
\end{lemma}

\begin{lemma}[Edge count in a clique]
  \label{lem:clique_size}
  \lean{clique_size}
  \uses{lem:UniformBetter_facts}
  \leanok
  If the support has size $k$, then the number of supported edges is $k(k-1)/2$.
\end{lemma}

\begin{lemma}[A light computation]
  \label{lem:computation}
  \lean{computation}
  \leanok
  $\displaystyle \big(k(k-1)/2\big)\cdot(1/k)^2=\tfrac12\,(1-1/k)$ for $k>0$.
\end{lemma}

\begin{lemma}[Monotonicity of the bound]
  \label{lem:bound_real}
  \lean{bound}
  \lean{bound_real}
  \leanok
  The function $k\mapsto \tfrac12(1-\tfrac1k)$ is nondecreasing in $k$ (for $k\ge1$).
\end{lemma}

\begin{theorem}[Final bound inside a clique]
  \label{lem:finale_bound}
  \lean{finale_bound}
  \uses{lem:Better_non_decr, lem:Better_forms_clique, lem:UniformBetter_fw_ge, def:UniformBetter, lem:UniformBetter_edges_value, lem:UniformBetter_clique, lem:bound_real, lem:computation, lem:clique_size, lem:UniformBetter_edges_value}
  \leanok
  If $W$ is supported on a clique of size $k\le p-1$, then
  \[
    W.\mathrm{fw}\;\le\;\tfrac12\,(1-1/(p-1)).
  \]
\end{theorem}

\begin{definition}[Uniform weights over all vertices]
  \label{def:UnivFun}
  \lean{UnivFun}
  \leanok
  The uniform vertex-weight function assigning $1/|V|$ to each vertex.
\end{definition}

\begin{lemma}[Total weight under $\texttt{UnivFun}$]
  \label{lem:UnivFun_weight}
  \lean{UnivFun_weight}
  \uses{def:UnivFun}
  \leanok
  $(\texttt{UnivFun}\,G).\mathrm{fw}=\#E\cdot(1/|V|)^2$.
\end{lemma}

\begin{theorem}[Turán's Theorem]
  \label{thm:turans}
  \lean{turans}
  \uses{def:UnivFun, lem:UnivFun_weight, lem:finale_bound, lem:computation}
  \leanok
  Let $p\ge 2$ and let $G$ be a $p$-clique-free graph. Then
  \[
    \#E \;\le\; \tfrac12\Bigl(1-\tfrac1{p-1}\Bigr)\,(\#V)^2.
  \]
\end{theorem}